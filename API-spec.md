# API仕様書

## 概要

このドキュメントは、Ruby Sinatra Example Appのエンドポイントの仕様を定義します。

### アプリケーション情報

- **フレームワーク**: Sinatra (Ruby)
- **バージョン**: 3
- **依存関係**:
  - sinatra
  - httparty
  - json

---

## エンドポイント一覧

### 1. ホームページ

**エンドポイント**: `/hello`

**メソッド**: `GET`

**説明**: アプリケーションのホームページ。Hello worldメッセージとサーバーの環境変数を表示します。

#### リクエスト

- **パラメータ**: なし
- **ヘッダー**: なし（必須）

#### レスポンス

**ステータスコード**: `200 OK`

**Content-Type**: `text/html`

**レスポンスボディ**:
```html
Hello world! Version 3. Now with test-suite! </br>
Environment: </br> [環境変数のJSON形式] </br>
```

**レスポンスの内容**:
- アプリケーションのバージョン情報
- サーバーの全環境変数をJSON形式で表示（改行は`</br>`タグに変換）

#### 実装場所

`app.rb:8-13`

---

### 2. 挨拶エンドポイント

**エンドポイント**: `/greetings`

**メソッド**: `GET`

**説明**: シンプルな挨拶メッセージを返します。

#### リクエスト

- **パラメータ**: なし
- **ヘッダー**: なし（必須）

#### レスポンス

**ステータスコード**: `201 Created`

**Content-Type**: `text/html`

**レスポンスボディ**:
```
Hello!
```

#### 実装場所

`app.rb:15-18`

---

### 3. Hello Worldエンドポイント

**エンドポイント**: `/hello-world`

**メソッド**: `GET`

**説明**: Hello, Worldメッセージを返します。

#### リクエスト

- **パラメータ**: なし
- **ヘッダー**: なし（必須）

#### レスポンス

**ステータスコード**: `201 Created`

**Content-Type**: `text/html`

**レスポンスボディ**:
```
Hello, World
```

#### 実装場所

`app.rb:20-23`

---

### 4. Googleプロキシ

**エンドポイント**: `/google`

**メソッド**: `GET`

**説明**: Google.comのコンテンツを取得してプロキシとして返します。リダイレクトを自動的にフォローします。

#### リクエスト

- **パラメータ**: なし
- **ヘッダー**: なし（必須）

#### レスポンス

**ステータスコード**: `200 OK`

**Content-Type**: Google.comから返されるContent-Type（通常は`text/html`）

**レスポンスボディ**:
Google.comから取得したHTMLコンテンツをそのまま返します。

**機能の詳細**:
- HTTPartyライブラリを使用してGoogle.comにHTTPリクエストを送信
- リダイレクトを自動的にフォロー（`follow_redirects: true`）
- 取得したレスポンスボディをそのまま返す

#### 実装場所

`app.rb:26-28`

---

### 5. Yahooプロキシ

**エンドポイント**: `/yahoo`

**メソッド**: `GET`

**説明**: Yahoo.comのコンテンツを取得してプロキシとして返します。リダイレクトを自動的にフォローします。

#### リクエスト

- **パラメータ**: なし
- **ヘッダー**: なし（必須）

#### レスポンス

**ステータスコード**: `200 OK`

**Content-Type**: Yahoo.comから返されるContent-Type（通常は`text/html`）

**レスポンスボディ**:
Yahoo.comから取得したHTMLコンテンツをそのまま返します。

**機能の詳細**:
- HTTPartyライブラリを使用してYahoo.comにHTTPリクエストを送信
- リダイレクトを自動的にフォロー（`follow_redirects: true`）
- 取得したレスポンスボディをそのまま返す

#### 実装場所

`app.rb:30-34`

---

## エラーハンドリング

現在のバージョンでは、明示的なエラーハンドリングは実装されていません。Sinatraのデフォルトのエラー処理が適用されます。

---

## テスト

アプリケーションにはRSpecを使用したテストスイートが含まれています。

**テストケース**:
1. ホームページ（`/hello`）へのアクセステスト - ステータスコード200を返すことを確認
2. Hello worldメッセージの表示テスト - レスポンスボディに"Hello world"が含まれることを確認

**テストファイル**: `spec/app_spec.rb`

---

## セットアップと実行

### 前提条件

- Ruby 2.0.0以上
- Bundler

### インストール

```bash
bundle install
```

### 実行

```bash
bundle exec rackup config.ru
```

または

```bash
bundle exec ruby app.rb
```

### テストの実行

```bash
bundle exec rspec
```

---

## 注意事項

1. `/google`エンドポイントは外部サービス（Google.com）に依存しているため、Googleのサービスが利用できない場合や、ネットワークの問題がある場合は正常に動作しない可能性があります。

2. 環境変数には機密情報が含まれる可能性があるため、`/hello`エンドポイントを本番環境で公開する際は、環境変数の表示機能を削除またはアクセス制限を設けることを推奨します。

---

## ライセンスとサポート

詳細については、プロジェクトのリポジトリを参照してください。
